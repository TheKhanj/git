#!/usr/bin/env bash

. 'inc/github.bash'

CONCURRENCY=10

mkdir -p "/srv/git"

# shellcheck disable=SC2016
_github_list_repos |
	parallel -j "$CONCURRENCY" '
    repo_url={}
    repo_name=$(basename "$repo_url" .git)
    target="/srv/git/$repo_name"
    if [ ! -d "$target" ]; then
        echo "Cloning $repo_url into $target"
        git clone "$repo_url" "$target"
    else
        echo "$target already exists, skipping"
    fi
'
