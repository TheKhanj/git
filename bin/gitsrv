#!/usr/bin/env bash

set -e

. 'inc/gitsrv.bash'

init() {
	_gitsrv_init
}

rsync() {
	_gitsrv_rsync_all
}

#
# Create a new git repository with a github mirror
#
# Example:
#   gitsrv new @thekhanj/repo thekhanj/public/repo
#
new() {
	local github="$1"
	local path="$2"

	_gitsrv_validate_github "$github" &&
		_gitsrv_validate_path "$path" ||
		return 1

	_gitsrv_new "$github" "$path"
}

set_hooks() {
	local github="$1"
	local dir="$2"

	_gitsrv_validate_github "$github" ||
		return 1

	if ! [ -d "$dir" ]; then
		echo "gitsrv: directory doesn't exist: $dir" >&2
		return 1
	fi

	_gitsrv_set_hooks "$github" "$dir"
}

"$@"
